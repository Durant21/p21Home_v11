apt-get update
apt-get upgrade -y

ufw allow 22
ufw allow 80
ufw allow 443
ufw enable

apt install fail2ban

apt-get install --no-install-recommends -y -q build-essential
apt-get install --no-install-recommends -y -q git python3 python3-dev wget unzip nload

# for nginx latest
(sudo apt-get install software-properties-common)
(sudo apt-get update)
add-apt-repository ppa:nginx/development
apt-get update
apt install python-software-properties
apt install nginx

apt install python3-pip
pip3 install uwsgi
pip3 install glances

mkdir /webapps
mkdir /webapps/logs
mkdir /webapps/logs/p21Home_v11
mkdir /webapps/logs/p21Home_v11/app_log
cd /webapps

# working dir
/webapps/proto21/p21Home/webapps/proto21_home

git config --global credential.helper cache
git config --global credential.helper 'cache --timeout=360000'

git clone https://github.com/Durant21/p21Home_v11.git


cd /webapps/p21Home_v11/p21Home_v11/
python3 setup.py develop


cp /webapps/p21Home_v11/p21Home_v11/p21Home_v11/etc/init/p21Home_v11_svc.service /etc/systemd/system/

systemctl start p21Home_v11_svc
systemctl enable p21Home_v11_svc
systemctl status p21Home_v11_svc


# CAREFUL HERE. If you are using default, maybe skip this
rm /etc/nginx/sites-enabled/default

cp /webapps/p21Home_v11/p21Home_v11/p21Home_v11/etc/nginx/sites-available/p21Home_v11_service.nginx /etc/nginx/sites-available/
cp /webapps/p21Home_v11/p21Home_v11/p21Home_v11/etc/nginx/sites-available/p21Home_v11_service.nginx /etc/nginx/sites-enabled/

update-rc.d nginx enable

service nginx start
service nginx restart